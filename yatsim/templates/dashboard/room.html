{% extends "../base.html" %}
{% load static %}

{% block header_text %}Dashboard{% endblock %}

{% block content %}

Hello {{ user.username }}, <a href={% url "logout" %}>logout</a> <a href={% url "dashboard" %}>dashboard</a>

<br>
{{room.id}}: <b>{{room.owner.username}}</b>/{{ room.room_name }}
<br>
{{room.height}}, {{room.width}}

<br>
<br>
<br>

<table>
{% for cell_row in cells %}
    <tr>
    {% for cell in cell_row %}
        <td>
            <div class="cell">
                <img class="direction{{cell.0.direction}}" width="32" height="32" src="{% static 'cells/' %}type{{cell.0.type}}.png"/>
                {% if cell.1 %}
                <img class="train direction{{cell.1.1}}" width="32" height="32" src="{% static 'trains/' %}type{{cell.1.0}}.png"/>
                {% endif %}
            </div>
        </td>
    {% endfor %}
    </tr>
{% endfor %}
</table>

<h3>
    Cell Operations:
</h3>

<form class="form-group" action="/room/place/{{room.id}}/" method="post">
    {% csrf_token %}
    <label for="x">X:</label><br>
    <input  class="form-control" type="number" id="x" name="x"><br>
    <label for="y">Y:</label><br>
    <input  class="form-control" type="number" id="y" name="y"><br>
    <label for="type">Cell Type:</label><br>
    <input  class="form-control" type="number" id="type" name="type"><br>

    <button class="btn btn-default" type="submit" >Place Cell</button>
</form>

<br>

<form class="form-group" action="/room/rotate/{{room.id}}/" method="post">
    {% csrf_token %}
    <label for="x">X:</label><br>
    <input  class="form-control" type="number" id="x" name="x"><br>
    <label for="y">Y:</label><br>
    <input  class="form-control" type="number" id="y" name="y"><br>
    <label for="direction">Direction:</label><br>
    <input  class="form-control" type="number" id="direction" name="direction"><br>

    <button class="btn btn-default" type="submit" >Rotate Cell</button>
</form>

<br>

<form class="form-group" action="/room/switch/{{room.id}}/" method="post">
    {% csrf_token %}
    <label for="x">X:</label><br>
    <input  class="form-control" type="number" id="x" name="x"><br>
    <label for="y">Y:</label><br>
    <input  class="form-control" type="number" id="y" name="y"><br>

    <button class="btn btn-default" type="submit" >Switch Cell</button>
</form>

<h3>
    Guests:
</h3>
<ol>
    {% for u in room.guests.all %}
        <li>{{u.username}}</li>
    {% empty %}
        No guests :(
    {% endfor %}
</ol>

<form class="form-group" action="/room/clone/{{room.id}}/" method="post">
    {% csrf_token %}
    <label for="room_name">Room name:</label><br>
    <input  class="form-control" type="text" id="room_name" name="room_name">

    <button class="btn btn-default" type="submit" >Clone</button>
</form>
<br/>

{% if is_owner %}
<form class="form-group" action="/room/delete/{{room.id}}/" method="post">
    {% csrf_token %}
    <button class="btn btn-default" type="submit" >Delete Room</button>
</form>
<br/>

<form class="form-group" action="/room/add/{{room.id}}/" method="post">
    {% csrf_token %}
    <label for="user_id">Choose user:</label><br>
    <select name="user_id" id="add_username">
        {% for u in users %}
            <option value="{{u.id}}">{{u.username}}</option>
        {% endfor %}
    </select>

    <button class="btn btn-default" type="submit" >Add User</button>
</form>
<br/>

<form class="form-group" action="/room/remove/{{room.id}}/" method="post">
    {% csrf_token %}
    <label for="user_id">Choose user:</label><br>
    <select name="user_id" id="rem_username">
        {% for u in room.guests.all %}
            <option value="{{u.id}}">{{u.username}}</option>
        {% endfor %}
    </select>

    <button class="btn btn-default" type="submit" >Remove User</button>
</form>
{% else %}
<form class="form-group" action="/room/leave/{{room.id}}/" method="post">
    {% csrf_token %}
    <button class="btn btn-default" type="submit" >Leave</button>
</form>
<br/>
{% endif %}

<br/>
<form class="form-group" action="/room/remove_train/{{room.id}}/" method="post">
    {% csrf_token %}
    <label for="train_id">Choose train:</label><br>
    <select name="train_id" id="train_id">
        {% for train in trains %}
            <option value="{{train.id}}">{{train}}</option>
        {% endfor %}
    </select>
    <button class="btn btn-default" type="submit" >Remove Train</button>
</form>
<br/>

<form class="form-group" action="/room/add_train/{{room.id}}/" method="post">
    {% csrf_token %}
    <input  class="form-control" type="text" id="train_type" name="train_type">
    <label for="train_type">train type:</label><br>

    <input  class="form-control" type="number" id="train_length" name="train_length">
    <label for="train_length">train length:</label><br>

    <label for="station_id">Choose station:</label><br>
    <select name="station_id" id="station_id">
        {% for station in stations %}
            <option value="{{station.id}}">{{station}}</option>
        {% endfor %}
    </select>
    <button class="btn btn-default" type="submit" >Add Train</button>
</form>

<form class="form-group" action="/room/start/{{room.id}}/" method="post">
    {% csrf_token %}
    <button class="btn btn-default" type="submit" >START</button>
</form>

<form class="form-group" action="/room/stop/{{room.id}}/" method="post">
    {% csrf_token %}
    <button class="btn btn-default" type="submit" >STOP</button>
</form>

{% endblock %}
